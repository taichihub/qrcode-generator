# QRコード一括作成システム

CSVファイルのデータと任意の設定をもとにQRコードを一括で作成するシステムです

## 環境
- python (ver3.10.2)

<b>《使用ライブラリ》</b>
- pandas (ver2.1.4)
- qrcode (ver7.4.2)
- pillow (ver10.2.0)
- pytest (ver7.4.4)
- autopep8 (ver2.0.4)

※パッケージ管理にpipenvを使用<br>
・[pipenv(github)](https://github.com/pypa/pipenv)<br>
・[pipenv(qiita)](https://qiita.com/y-tsutsu/items/54c10e0b2c6b565c887a)

## 使用方法
- 環境構築を行う
- ルートディレクトリに`data`フォルダと`qr_code`フォルダを作成する
- `config/setting.py`でQRコード生成時の設定を行う
- (QRコード中央に画像を挿入したい場合は`img/`配下に画像を配置する)
- CSVファイルを`data/`配下に配置する
- 実行する
- `qr_code/`配下にQRコードが生成される

## 環境構築
- 自分のローカル環境にクローンする
```
git clone git@github.com:frame-and-surface/app_qrcode-generator_main.git
```
- クローンしたディレクトリに移動
```
cd app_qrcode-generator_main
```
- Pipfileで管理されているパッケージをインストール
```
pipenv install
```
`✔ Success!`の文字が表示されればインストール成功
- 仮想環境に入る
```
pipenv shell
```

## フォルダの作成
- 環境構築が完了したら、ルートディレクトリに`data`フォルダと`qr_code`フォルダを作成してください。
- `data`フォルダ：QRコードに変換するデータが入ったCSVファイルを格納するフォルダ
- `qr_code`フォルダ：変換済みのQRコードのファイルが格納されるフォルダ
- 注意：フォルダ名を`data`,`qr_code`以外にしないでください。プログラムが動作しなくなります。

## ディレクトリ構造の理解
```
app_qrcode-generator_main/
├── .github/ (編集厳禁)
├── config/
│   ├── log_messages.yml (編集厳禁)
│   ├── setting.py (QRコード生成時の設定ファイル)(※1)
│   └── setup_log.py (編集厳禁)
├── data/ (CSVファイルを配置するフォルダ)(※2)
├── img/ (QRコードの中央に画像を挿入する際に使用するフォルダ)(※3)
├── qr_code/ (生成されたQRコードガ格納されるディレクトリ)(※4)
├── src/ (編集厳禁)
├── test/ (編集厳禁)
├── .gitignore (編集厳禁)
├── Dockerfile (編集厳禁)
├── Makefile (編集厳禁)
├── Pipfile (編集厳禁)
├── Pipfile.lock (編集厳禁)
├── pytest.ini (編集厳禁)
├── README.md (編集厳禁)
└── setup.py (編集厳禁)
```
(※1)QRコードを生成する際の設定を詳しい設定方法は後述の「`setting.py`の使用方法(QRコード生成に関する設定)」を参考にしてください<br>
(※2)dataフォルダ配下にCSVファイルを配置します。詳しい仕様は後述の「dataフォルダに関するルール・仕様」「CSVファイル例」を参考にしてください。<br>
(※3)imgフォルダ配下にQRコード中央に配置する画像を配置します。詳しい仕様は後述の「imgフォルダに関するルール・仕様」を参考にしてください。<br>
(※4)qr_codeフォルダ配下に、dataフォルダ配下に配置したCSVファイルを元に生成されたQRコードが生成され格納されます。詳しい仕様は後述の「CSVファイルのルール・仕様」「qr_codeフォルダに関するルール・仕様」「qr_codeフォルダ配下への出力ケース」を参考にしてください。<br>

## `setting.py`の使用方法(QRコード生成に関する設定)
- QRコードのバージョン (QR_VERSION)
  - デフォルト値：1
  - [(参考)QRコードのバージョンについて](https://www.qrcode.com/about/version.html)
- エラー訂正レベル (ERROR_CORRECTION_LEVEL)
  - デフォルト値：Q
  - [(参考)エラー訂正レベルについて](https://www.mediaseek.co.jp/barcode/10908/#:~:text=QR%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AB%E3%81%AF%E8%AA%A4%E3%82%8A,L%E3%81%A8%E3%81%AA%E3%81%A3%E3%81%A6%E3%81%84%E3%81%BE%E3%81%99%E3%80%82)
- QRコードの大きさ (BOX_SIZE)
  - デフォルト値：10 (1つのドットが10ピクセル四方の大きさ)
- 境界線のサイズ (BORDER_SIZE)
  - デフォルト値：4
- QRコードの色 (QR_COLOR)
  - 16進数のRGB(#rrggbb)の形式で入力
  - デフォルト：黒`#000000`
- QRコードの背景色 (QR_BACKGROUND_COLOR)
  - 16進数のRGB(#rrggbb)の形式で入力
  - デフォルト：白`#FFFFFF`
- 背景透過(任意) (QR_BACKGROUND_TRANSPARENT)
  - False：背景透過しない
  - True：背景透過する
  - デフォルト：False
(※)上記以外の定数については編集厳禁です。

## dataフォルダに関するルール・仕様
- 配置したCSVファイル内のデータを元にQRコードを生成します。
(CSVファイルのルール・仕様については下記「CSVファイルのルール・仕様」の項目を参照)
- QRコードに変換するCSVファイル、1ファイルのみを配置してください。

## CSVファイルのルール・仕様
- ヘッダ
  - 行数,ファイル名,URL
- 行数
  - 欠番なく1から記述してください。参考：下記のCSVファイル例
- ファイル名
  - 生成するQRコードのファイル名になります。
  - ファイル名の末尾に`.png`を必ずつけてください。参考：下記のCSVファイル例
  - ファイル名はユニークにしてください。同一のファイル名が存在すると上書き保存されてしまい、最初に保存された方のデータが失われてしまいます。
    (ナンバーオプションを仕様する場合は考慮しなくて大丈夫です)
- URL
  - パラメータも含めた完全なURLを記述してください。参考：下記のCSVファイル例
- その他
  - ファイル内に空行を入れないでください
  - 1行目のヘッダに何も書き加えないでください
  - 行数、ファイル名、URL以外の情報を書き加えないでください(2行目以降)
  - カンマの後にスペースを入れる必要はありません。参考：下記のCSVファイル例

## CSVファイル例
```csv
行数,ファイル名,URL
1,田中太郎.png,https://example.com/?parameter_a=1?parameter_b=2
2,鈴木直美.png,https://example.com/?parameter_a=4
3,田中花子.png,https://example.com/?parameter_b=2?parameter_c=7?parameter_d=3?
.....
```

## imgフォルダに関するルール・仕様
- QRコードの中央に画像を配置したい場合は、imgディレクトリ配下に画像を挿入してください
- imgフォルダ配下に何も画像を配置しない場合は、通常のQRコードが生成されます。
- 画像を配置する場合、拡張子は必ず`.png`にしてください。
- 配置する画像は1枚のみにしてください。2枚以上は配置できません。
- 背景透過かつQRコードの中央に画像を配置したい場合は、imgフォルダに置く画像も背景透過したものを配置してください。

## qr_codeフォルダに関するルール・仕様
- qr_codeフォルダ配下にサブフォルダが作成され、そのサブフォルダ配下にQRコードファイルが格納される。(参考：qr_codeフォルダ配下への出力ケース)
- qr_codeフォルダ配下のサブフォルダ名は、CSVファイル名に依存します。(参考：qr_codeフォルダ配下への出力ケース)
- 1000件毎にQRコードの出力ディレクトリが分割されます。(参考：qr_codeフォルダ配下への出力ケース)

## オプション説明
### 途中再開オプション
- 用途：処理を途中から再開できるオプション(処理が何らかの原因で途中で止まってしまった際に使用)
- `-r [処理を再開させる行数] `,`--resume [処理を再開させる行数]`で使用可能
- 注意：行数は、CSVファイル1列目の行数を指します。
- 「1500番目から再開したかったが、1501番から再開してしまった」というようなミスに注意してください。
(どこまで正常に生成されたのか、それがCSVファイルの行数は何行目に当たるのかを確認するようにしてください。)
### ナンバーオプション
- 用途：元々のファイル名のままQRコードを出力するのではなく、番号をファイル名として出力する(例：1.png, 2.png, ...)
- `-n`,`--number`で使用可能
- 最初の実行でナンバーオプションを使用している際に何らかの原因で処理が中断されて途中再開したい場合は、途中再開オプション・ナンバーオプションを併用してコマンドを実行してください。
(理由：通常の実行とナンバーオプションの実行では出力されるファイル名が異なるので、実体は同じでも別ファイルとして保存されてしまう)

## 実行
- 通常コマンド
```
PYTHONPATH=. python src/read_csv.py
```
- 途中再開オプション
```
PYTHONPATH=. python src/read_csv.py -r [処理を再開させる行数]
```
```
PYTHONPATH=. python src/read_csv.py --resume [処理を再開させる行数]
```
- ナンバーオプション
```
PYTHONPATH=. python src/read_csv.py -n
```
```
PYTHONPATH=. python src/read_csv.py --number
```
- オプション併用
```
PYTHONPATH=. python src/read_csv.py -r [処理を再開させる行数] -n
```
```
PYTHONPATH=. python src/read_csv.py --resume [処理を再開させる行数] --number
```

## qr_codeフォルダ配下への出力ケース
### ケース1：通常ケース
- ファイル：`data/sample.csv`
- データ数：3000
- 通常コマンドで実行
- 実行中にエラー発生なし
```
qr_code/
├── sample/
│   ├── 1000/ (1〜1000番目のデータが入る)
│   │   ├── aaa.png
│   │   ├── bbb.png
│   │   └── ccc.png...
│   ├── 2000/ (1001〜2000番目のデータが入る)
│   │   ├── ddd.png
│   │   ├── eee.png
│   │   └── fff.png...
│   └── 3000/ (2001〜3000番目のデータが入る)
│       ├── ggg.png
│       ├── hhh.png
│       └── iii.png...
```
### ケース2：途中再開オプションを使用するケース
- ファイル：`data/sample.csv`
- データ数：3000
- 通常コマンドで実行後、1500番目の処理中に何らかの原因で処理がストップ(1499番までは正常に生成)
- 途中再開オプションで1500番目から処理を再開
```
qr_code/
├── sample/
│   ├── 1000/ (1〜1000番目のデータが入る)
│   │   ├── aaa.png
│   │   ├── bbb.png
│   │   └── ccc.png...
│   ├── 2000/ (1001〜2000番目のデータが入る)
│   │   ├── ddd.png
│   │   ├── eee.png
│   │   ├── ...
│   │   └── fff.png (1499番目、ここで処理がストップ) 
```
`PYTHONPATH=. python src/read_csv.py -r 1500`を実行
```
qr_code/
├── sample/
│   ├── 1000/ (1〜1000番目のデータが入る)
│   │   ├── aaa.png
│   │   ├── bbb.png
│   │   └── ccc.png...
│   ├── 2000/ (1001〜2000番目のデータが入る)
│   │   ├── ddd.png
│   │   ├── eee.png
│   │   └── fff.png...
│   └── 3000/ (2001〜3000番目のデータが入る)
│       ├── ggg.png
│       ├── hhh.png
│       └── iii.png... (3000番目まで正常に生成された)
```
### ケース3：ナンバーオプションを使用するケース
- ファイル：`data/sample.csv`
- データ数：3000
- ナンバーオプション付きコマンドで実行
- 実行中にエラー発生なし
```
qr_code/
├── sample/
│   ├── 1000/ (1〜1000番目のデータが入る)
│   │   ├── 1.png
│   │   ├── 2.png
│   │   └── 3.png...
│   ├── 2000/ (1001〜2000番目のデータが入る)
│   │   ├── 1001.png
│   │   ├── 1002.png
│   │   └── 1003.png...
│   └── 3000/ (2001〜3000番目のデータが入る)
│       ├── 2001.png
│       ├── 2002.png
│       └── 2003.png...
```
### ケース4：オプションを併用するケース
- ファイル：`data/sample.csv`
- データ数：3000
- ナンバーオプション付きコマンドで実行後、1500番目の処理中に何らかの原因で処理がストップ(1499番までは正常に生成)
- 途中再開オプションも含めて1500番目から処理を再開
```
qr_code/
├── sample/
│   ├── 1000/ (1〜1000番目のデータが入る)
│   │   ├── 1.png
│   │   ├── 2.png
│   │   └── 3.png...
│   ├── 2000/ (1001〜2000番目のデータが入る)
│   │   ├── 1001.png
│   │   ├── 1002.png
│   │   ├── ...
│   │   └── 1499.png (ここで処理がストップ)
```
`PYTHONPATH=. python src/read_csv.py -r 1500 -n`を実行
```
qr_code/
├── sample/
│   ├── 1000/ (1〜1000番目のデータが入る)
│   │   ├── 1.png
│   │   ├── 2.png
│   │   └── 3.png...
│   ├── 2000/ (1001〜2000番目のデータが入る)
│   │   ├── 1001.png
│   │   ├── 1002.png
│   │   └── 1003.png...
│   └── 3000/ (2001〜3000番目のデータが入る)
│       ├── 2001.png
│       ├── 2002.png
│       └── 2003.png...
```

<br>

## ドキュメント
- [簡易モジュール構成図・シーケンス図](https://drive.google.com/file/d/1QVUi4KcGqufxJIqEsboudCzGMNTTiXNh/view?usp=sharing)
